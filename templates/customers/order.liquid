{{ 'customer.css' | asset_url | stylesheet_tag }}

<div class="customer order">
  <div class="section-header text-center">
    <h1>{{ 'customer.account.my_order' | t }}</h1>
  </div>
  <div class="row">
    <div class="col-lg-3 col-md-12 col-sm-12">
      <ul class="myaccount_navigation">
        <li class="navigation-link--dashboard is-active"><a href="{{ routes.account_url }}">{{ 'customer.account.dashboard' | t }}</a></li>
        <li class="navigation-link--addresses"><a href="{{ routes.account_addresses_url }}">{{ 'customer.account.view_addresses' | t }}</a></li>
        <li class="navigation-link--log_out">{{ 'customer.account.log_out' | t | customer_logout_link }}</li>
      </ul>
    </div>
    <div class="col-lg-9 col-md-12 col-sm-12">
      {%- assign order_date = order.created_at | time_tag: format: "date_at_time" -%}
      <p><span>{{ 'customer.order.title' | t: name: order.name }} </span>{{ 'customer.order.date_html' | t: date: order_date }}</p>
      <div class="row">
        <div class="col-xl-8 col-sm-12 myaccount__order-history">
          {%- if order.cancelled -%}
            <div class="order--cancelled">
              {%- assign cancelled_at = order.cancelled_at | time_tag: format: "date_at_time" -%}
              <p>{{ 'customer.order.cancelled_html' | t: date: cancelled_at }}</p>
              <p>{{ 'customer.order.cancelled_reason' | t: reason: order.cancel_reason_label }}</p>
            </div>
          {%- endif -%}
          <div class="table-wrapper">
            <div class="content-order">
              <table class="order-table">
                <thead>
                  <tr>
                    <th scope="col" colspan="2">{{ 'customer.order.order_details' | t }}</th>
                  </tr>
                </thead>
                <tbody>
                  {%- for line_item in order.line_items -%}
                    <tr id="{{ line_item.key }}">
                      <th class="order-table__product" data-label="{{ 'customer.order.product' | t }}">
                        <div>
                          <span>{{ line_item.quantity }}</span>
                          {{ line_item.title | link_to: line_item.product.url }}
                          {%- assign property_size = line_item.properties | size -%}
                          {% unless line_item.selling_plan_allocation == nil and property_size == 0 %}
                            <div class="item-props">
                              {% unless line_item.selling_plan_allocation == nil %}
                                <span class="item-props__property">
                                  {{ line_item.selling_plan_allocation.selling_plan.name }}
                                </span>
                              {% endunless %}
                              {% if property_size != 0 %}
                                {% for property in line_item.properties %}
                                  {% assign property_first_char = property.first | slice: 0 %}
                                  {% if property.last != blank and property_first_char != '_' %}
                                    <span class="item-props__property">
                                      {{ property.first }}:&nbsp;
                                      {%- if property.last contains '/uploads/' -%}
                                        <a href="{{ property.last }}">{{ property.last | split: '/' | last }}</a>
                                      {%- else -%}
                                        {{ property.last }}
                                      {%- endif -%}
                                    </span>
                                  {% endif %}
                                {% endfor %}
                              {% endif %}
                            </div>
                          {% endunless %}
                          {%- if line_item.line_level_discount_allocations != blank -%}
                            <ul class="order-discount order-discount--list order-discount--title" aria-label="{{ 'customer.order.discount' | t }}">
                              {%- for discount_allocation in line_item.line_level_discount_allocations -%}
                                <li class="order-discount__item">
                                  {% render 'icon-saletag' %}{{ discount_allocation.discount_application.title }} (-{{ discount_allocation.amount | money }})
                                </li>
                              {%- endfor -%}
                            </ul>
                          {%- endif -%}
                        </div>
                        {%- if line_item.fulfillment -%}
                          <div class="note">
                            {%- assign created_at = line_item.fulfillment.created_at | time_tag: format: 'date' -%}
                            {{ 'customer.order.fulfilled_at_html' | t: date: created_at }}
                            <div>
                              {%- if line_item.fulfillment.tracking_url -%}
                                <a href="{{ line_item.fulfillment.tracking_url }}">
                                  {{ 'customer.order.track_shipment' | t }}
                                </a>
                              {%- endif -%}
                              <div>
                                {{ line_item.fulfillment.tracking_company }}
                                {%- if line_item.fulfillment.tracking_number -%} #{{ line_item.fulfillment.tracking_number }} {%- endif -%}
                              </div>
                            </div>
                          </div>
                        {%- endif -%}
                      </th>
                      <td class="text-right" data-label="{{ 'customer.order.total' | t }}">
                        {%- if line_item.original_price != line_item.final_price or line_item.unit_price_measurement -%}
                          <dl>
                            <dt>
                              <span class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
                            </dt>
                            <dd>
                              {% if line_item.original_price == line_item.final_price %}
                                {{ line_item.original_line_price | money }}
                              {% else %}
                                <s>{{ line_item.original_line_price | money }}</s>
                              {% endif %}
                            </dd>
                            <dt>
                              <span class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</span>
                            </dt>
                            <dd>
                              <span class="order-discount{% if line_item.original_price == line_item.final_price %} hidden{% endif %}">{{ line_item.final_line_price | money }}</span>
                            </dd>
                            {%- if line_item.unit_price_measurement -%}
                              <dt>
                                <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                              </dt>
                              <dd class="unit-price">
                                <span>
                                  {%- capture unit_price_separator -%}
                                    <span aria-hidden="true">/</span><span class="visually-hidden">{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span>
                                  {%- endcapture -%}
                                  {%- capture unit_price_base_unit -%}
                                    {%- if line_item.unit_price_measurement.reference_value != 1 -%}
                                      {{- line_item.unit_price_measurement.reference_value -}}
                                    {%- endif -%}
                                    {{ line_item.unit_price_measurement.reference_unit }}
                                  {%- endcapture -%}
                                  <span data-unit-price>{{ line_item.unit_price | money }}</span>{{- unit_price_separator -}}{{- unit_price_base_unit -}}
                                </span>
                              </dd>
                            {%- endif -%}
                          </dl>
                        {%- else -%}
                          {{ line_item.original_line_price | money }}
                        {%- endif -%}
                      </td>
                    </tr>
                  {%- endfor -%}
                </tbody>
                <tfoot>
                  <tr>
                    <th scope="row">{{ 'customer.order.subtotal' | t }}</th>
                    <td class="text-right" data-label="{{ 'customer.order.subtotal' | t }}">{{ order.line_items_subtotal_price | money }}</td>
                  </tr>

                  {%- if order.cart_level_discount_applications != blank -%}
                    <tr>
                      {%- for discount_application in order.cart_level_discount_applications -%}
                        <th scope="row">
                          {{ 'customer.order.discount' | t }}
                          <span class="order-discount order-discount--title">
                            {% render 'icon-saletag' %}{{- discount_application.title -}}
                          </span>
                        </th>
                        <td class="text-right" data-label="{{ 'customer.order.discount' | t }}">
                          <div class="order-discount-wrapper">
                            <span class="order-discount order-discount--title text-left medium-up--hide">
                              {% render 'icon-saletag' %}{{- discount_application.title -}}
                            </span>
                            <span class="order-discount">-{{ discount_application.total_allocated_amount | money }}</span>
                          </div>
                        </td>
                      {%- endfor -%}
                    </tr>
                  {%- endif -%}

                  {%- for shipping_method in order.shipping_methods -%}
                    <tr>
                      <th scope="row">{{ 'customer.order.shipping' | t }} ({{ shipping_method.title }})</th>
                      <td class="text-right" data-label="{{ 'customer.order.shipping' | t }} ({{ shipping_method.title }})">{{ shipping_method.price | money }}</td>
                    </tr>
                  {%- endfor -%}

                  {%- for tax_line in order.tax_lines -%}
                    <tr>
                      <th scope="row">{{ 'customer.order.tax' | t }} ({{ tax_line.title }} {{ tax_line.rate | times: 100 }}%)</th>
                      <td class="text-right" data-label="{{ 'customer.order.tax' | t }} ({{ tax_line.title }} {{ tax_line.rate | times: 100 }}%)">{{ tax_line.price | money }}</td>
                    </tr>
                  {%- endfor -%}

                  {%- if order.total_duties -%}
                    <tr role="row">
                      <td id="RowDuties" role="rowheader" scope="row" colspan="4">{{ 'customer.order.total_duties' | t }}</td>
                      <td headers="RowDuties" role="cell" data-label="{{ 'customer.order.total_duties' | t }}">{{ order.total_duties | money }}</td>
                    </tr>
                  {%- endif -%}

                  <tr>
                    <th scope="row">{{ 'customer.order.total' | t }}</th>
                    <td class="text-right" data-label="{{ 'customer.order.total' | t }}">{{ order.total_price | money_with_currency }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
            
          </div>
        </div>
        <div class="col-xl-4 col-sm-12 myaccount__account-details">
          <div class="billing-address">
            <h3>{{ 'customer.order.billing_address' | t }}</h3>

            <p><strong>{{ 'customer.order.payment_status' | t }}:</strong> {{ order.financial_status_label }}</p>

            {{ order.billing_address | format_address }}
          </div>
          
          <div class="shipping-address">
            <h3>{{ 'customer.order.shipping_address' | t }}</h3>

            <p><strong>{{ 'customer.order.fulfillment_status' | t }}:</strong> {{ order.fulfillment_status_label }}</p>

            {{ order.shipping_address | format_address }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>